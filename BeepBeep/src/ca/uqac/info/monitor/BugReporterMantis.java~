/**
* File: BugReporterMantis.java
*
* Author: RaphaÃ«l Laguerre
*
* Last modified: 15/06/2013
*
* Description: This class extends BugReporter. It is used to report bugs in Mantis, by using the SOAP web service interface.
*
*/
package ca.uqac.info.monitor;

import java.util.Date;
import java.util.GregorianCalendar;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.File;

import java.net.MalformedURLException;
import java.net.URL;

import org.mantisbt.connect.IMCSession;
import org.mantisbt.connect.MCException;
import org.mantisbt.connect.axis.MCSession;
import org.mantisbt.connect.model.IIssue;
import org.mantisbt.connect.model.IProject;

public class BugReporterMantisWS extends BugReporter {
	private URL url;
	private String user;
	private String passwd;
	private String category;
	private int projectID;
	private IMCSession session;

	public BugReporterWS (String specFile, String brokenProperty, String trace, URL url, String user, String passwd, String category, int projectID) {
		super(specFile, brokenProperty, trace);		
		this.url = url;
		this.user = user;
		this.passwd = passwd;
		this.category = category;
		this.projectID = projectID;
		session = new MCSession(url, user, passwd);
	}	

	public BugReporterWS (String specFile, String brokenProperty, String trace, URL url, String user, String passwd) {
		super(specFile, brokenProperty, trace);		
		this.url = url;
		this.user = user;
		this.passwd = passwd;
		category = "General";
		projectID = "1";
		session = new MCSession(url, user, passwd);
	}		

	@override
	public void sendReport(){				
		addIssue();		
	}	

	public static void addIssue() throws MCException{
		try{	
		IIssue issue = session.newIssue(projectID);
		issue.setDescription(brokenProperty);
		issue.setSummary(specFile);		
		issue.setCategory(category);
		session.addIssue(issue);
		}catch (MCException e) {
			e.printStackTrace();
		}
	}
}


